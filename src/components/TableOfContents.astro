---
// 目录组件 - 用于显示文章标题导航
---

<!-- 桌面端嵌入式目录 -->
<div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm p-6">
  <div class="toc-content">
    <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3 flex items-center">
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
      </svg>
      目录
    </h3>
    <ul id="toc-list" class="space-y-1 text-sm">
      <!-- 目录项将通过JavaScript动态生成 -->
    </ul>
  </div>
</div>

<style>
  /* 基础目录样式 */
  .toc-content {
    font-family: inherit;
  }
  
  .toc-item {
    display: block;
    padding: 0.25rem 0.5rem;
    color: #6b7280;
    text-decoration: none;
    border-radius: 0.375rem;
    transition: all 0.2s ease-in-out;
    border-left: 2px solid transparent;
  }
  
  .toc-item:hover {
    background-color: #f3f4f6;
    color: #374151;
  }
  
  .dark .toc-item:hover {
    background-color: #374151;
    color: #d1d5db;
  }
  
  .toc-item.active {
    color: #2563eb;
    background-color: #dbeafe;
    border-left-color: #2563eb;
  }
  
  .dark .toc-item.active {
    color: #60a5fa;
    background-color: #1e3a8a;
    border-left-color: #60a5fa;
  }
  
  /* H1 标题样式 */
  .toc-item.level-1 {
    font-weight: 700;
    font-size: 1rem;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
    background-color: #f8fafc;
    color: #1e293b;
  }
  
  .dark .toc-item.level-1 {
    background-color: #1e293b;
    color: #f1f5f9;
  }
  
  /* H2 标题样式 */
  .toc-item.level-2 {
    font-weight: 600;
    font-size: 0.875rem;
    padding-left: 1.5rem;
    margin-top: 0.5rem;
    position: relative;
    color: #374151;
  }
  
  .toc-item.level-2::before {
    content: "";
    position: absolute;
    left: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background-color: #6366f1;
  }
  
  .dark .toc-item.level-2 {
    color: #d1d5db;
  }
  
  /* H3 标题样式 */
  .toc-item.level-3 {
    font-weight: 500;
    font-size: 0.8125rem;
    padding-left: 2.5rem;
    color: #6b7280;
    position: relative;
  }
  
  .toc-item.level-3::before {
    content: "";
    position: absolute;
    left: 2rem;
    top: 50%;
    transform: translateY(-50%);
    width: 2px;
    height: 2px;
    border-radius: 50%;
    background-color: #9ca3af;
  }
  
  .dark .toc-item.level-3 {
    color: #9ca3af;
  }
  
  /* H4 标题样式 */
  .toc-item.level-4 {
    font-weight: 400;
    font-size: 0.75rem;
    padding-left: 3.5rem;
    color: #9ca3af;
  }
  
  .dark .toc-item.level-4 {
    color: #6b7280;
  }
  
  /* H5 标题样式 */
  .toc-item.level-5 {
    font-weight: 400;
    font-size: 0.75rem;
    padding-left: 4.5rem;
    color: #9ca3af;
    font-style: italic;
  }
  
  .dark .toc-item.level-5 {
    color: #6b7280;
  }
  
  /* H6 标题样式 */
  .toc-item.level-6 {
    font-weight: 400;
    font-size: 0.6875rem;
    padding-left: 5.5rem;
    color: #9ca3af;
    font-style: italic;
  }
  
  .dark .toc-item.level-6 {
    color: #6b7280;
  }
</style>

<script>
  // 生成目录
  function generateTableOfContents() {
    const tocList = document.getElementById('toc-list');
    const tocContainer = document.getElementById('table-of-contents');
    
    if (!tocList || !tocContainer) return;
    
    // 获取文章内容区域的所有标题
    const headings = document.querySelectorAll('.prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6');
    
    if (headings.length === 0) {
      tocContainer.style.display = 'none';
      return;
    }
    
    // 为每个标题添加ID（如果没有的话）
    headings.forEach((heading, index) => {
      if (!heading.id) {
        const text = heading.textContent || '';
        heading.id = `heading-${index}-${text.toLowerCase().replace(/[^\w\u4e00-\u9fff]+/g, '-')}`;
      }
    });
    
    // 生成目录项
    const tocItems = Array.from(headings).map(heading => {
      const level = parseInt(heading.tagName.charAt(1));
      const text = heading.textContent || '';
      const id = heading.id;
      
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = `#${id}`;
      a.textContent = text;
      a.className = `toc-item level-${level}`;
      a.onclick = (e) => {
        e.preventDefault();
        const target = document.getElementById(id);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          // 更新活动状态
          updateActiveItem(a);
        }
      };
      
      li.appendChild(a);
      return li;
    });
    
    // 清空并添加目录项
    tocList.innerHTML = '';
    tocItems.forEach(item => tocList.appendChild(item));
    
    // 设置滚动监听
    setupScrollSpy(headings);
  }
  
  // 设置滚动监听
  function setupScrollSpy(headings) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const id = entry.target.id;
            const activeLink = document.querySelector(`.toc-item[href="#${id}"]`);
            if (activeLink) {
              updateActiveItem(activeLink);
            }
          }
        });
      },
      { 
        rootMargin: '-20% 0px -35% 0px',
        threshold: 0
      }
    );
    
    headings.forEach(heading => observer.observe(heading));
  }
  
  // 更新活动项
  function updateActiveItem(activeLink) {
    // 移除所有活动状态
    document.querySelectorAll('.toc-item.active').forEach(item => {
      item.classList.remove('active');
    });
    
    // 添加活动状态
    activeLink.classList.add('active');
  }
  
  // 移动端目录切换
  function setupMobileToggle() {
    const toggleButton = document.getElementById('toc-toggle');
    const tocContainer = document.getElementById('table-of-contents');
    const overlay = document.getElementById('toc-overlay');
    
    if (!toggleButton || !tocContainer || !overlay) return;
    
    toggleButton.addEventListener('click', () => {
      const isVisible = tocContainer.classList.contains('show');
      
      if (isVisible) {
        tocContainer.classList.remove('show');
        overlay.classList.add('hidden');
        document.body.style.overflow = '';
      } else {
        tocContainer.classList.add('show');
        overlay.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }
    });
    
    overlay.addEventListener('click', () => {
      tocContainer.classList.remove('show');
      overlay.classList.add('hidden');
      document.body.style.overflow = '';
    });
  }
  
  // 页面加载完成后生成目录
  document.addEventListener('DOMContentLoaded', () => {
    generateTableOfContents();
    setupMobileToggle();
  });
</script> 